<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>IRON LADY ASSISTANT</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicon.png') }}">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #F3F4F5;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .chat-container {
      width: 450px;
      max-width: 100%;
      background: #DDDDDD;
      border-radius: 10px;
      box-shadow: 0 5px 25px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      height: 600px;
      border: 2px solid #E30220;
    }

    .chat-header {
      background: #E30220;
      color: #F3F4F5;
      padding: 20px;
      text-align: center;
      font-weight: 600;
      font-size: 18px;
    }

    #chatbox {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      background: #F3F4F5;
    }

    .message {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 18px;
      line-height: 1.4;
      word-wrap: break-word;
      font-size: 14px;
    }

    .user {
      align-self: flex-end;
      background: #E30220;
      color: #F3F4F5;
      border-bottom-right-radius: 4px;
    }

    .bot {
      align-self: flex-start;
      background: #DDDDDD;
      color: #242024;
      border-bottom-left-radius: 4px;
      border: 1px solid #BF0000;
    }

    .typing {
      align-self: flex-start;
      background: #DDDDDD;
      color: #242024;
      font-style: italic;
      border-bottom-left-radius: 4px;
      border: 1px solid #BF0000;
    }

    .timestamp {
      font-size: 10px;
      color: #242024;
      margin-top: 4px;
      text-align: right;
    }

    .dots::after {
      content: '';
      animation: dots 1.5s steps(3, end) infinite;
    }

    @keyframes dots {
      0% { content: ''; }
      33% { content: '.'; }
      66% { content: '..'; }
      100% { content: '...'; }
    }

    .quick-buttons {
      display: flex;
      gap: 6px;
      padding: 15px;
      background: #DDDDDD;
      border-top: 1px solid #BF0000;
      flex-wrap: wrap;
      justify-content: center;
    }

    .quick-btn {
      background: #F3F4F5;
      border: 1px solid #E30220;
      color: #E30220;
      padding: 6px 12px;
      border-radius: 15px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.2s;
      font-weight: 500;
    }

    .quick-btn:hover {
      background: #E30220;
      color: #F3F4F5;
    }

    .chat-input {
      display: flex;
      border-top: 1px solid #BF0000;
      background: #DDDDDD;
    }

    .chat-input input {
      flex: 1;
      border: none;
      padding: 15px;
      font-size: 14px;
      border-radius: 0;
      background: #F3F4F5;
      color: #242024;
      outline: none;
    }

    .chat-input button {
      background: #E30220;
      color: #F3F4F5;
      border: none;
      padding: 15px 20px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
      font-weight: 500;
    }

    .chat-input button:hover {
      background: #BF0000;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <img src="{{ url_for('static', filename='images/iron-lady-logo.png') }}" alt="IRON LADY" style="height: 24px; margin-right: 10px; vertical-align: middle;">
      IRON LADY ASSISTANT
      <div style="font-size: 12px; color: #DDDDDD; margin-top: 2px;">Built by Rudhr Chauhan</div>
    </div>
    <div id="chatbox"></div>
    
    <!-- Quick Buttons -->
    <div class="quick-buttons">
      <button class="quick-btn" onclick="sendQuickMessage('What programs does IRON LADY offer?')">Programs offered</button>
      <button class="quick-btn" onclick="sendQuickMessage('What is the program duration?')">Duration</button>
      <button class="quick-btn" onclick="sendQuickMessage('Who are the mentors/coaches?')">Mentors</button>
    </div>

    <form id="chat-form" class="chat-input">
      <input type="text" id="user_input" placeholder="Ask about IRON LADY..." required autocomplete="off">
      <button type="submit">Send</button>
    </form>
  </div>

  <script>
    const form = document.getElementById("chat-form");
    const chatbox = document.getElementById("chatbox");

    function getCurrentTime() {
      const now = new Date();
      return now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    }

    // Show welcome message when page loads
    function showWelcomeMessage() {
      const welcomeDiv = document.createElement("div");
      welcomeDiv.classList.add("message", "bot");
      welcomeDiv.innerHTML = `Hi! I am your IRON LADY ASSISTANT. ðŸ‘‹<br><br>I'm here to help you with information about IRON LADY's leadership programs, mentors, duration, and more.<br><br>How can I assist you today?<div class="timestamp">${getCurrentTime()}</div>`;
      chatbox.appendChild(welcomeDiv);
      scrollToBottom();
    }

    function scrollToBottom() {
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function sendQuickMessage(message) {
      document.getElementById("user_input").value = message;
      form.dispatchEvent(new Event('submit'));
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const input = document.getElementById("user_input");
      const userMessage = input.value.trim();
      if (!userMessage) return;

      // Clear input immediately
      input.value = "";

      // Show user message with timestamp
      const userDiv = document.createElement("div");
      userDiv.classList.add("message", "user");
      userDiv.innerHTML = `${userMessage}<div class="timestamp">${getCurrentTime()}</div>`;
      chatbox.appendChild(userDiv);
      scrollToBottom();

      // Create typing indicator
      const typingDiv = document.createElement("div");
      typingDiv.classList.add("message", "typing");
      typingDiv.innerHTML = "<span class='dots'></span>";
      chatbox.appendChild(typingDiv);
      scrollToBottom();

      // Start request
      const response = await fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: "user_input=" + encodeURIComponent(userMessage)
      });

      // Replace typing indicator with bot response
      const botDiv = document.createElement("div");
      botDiv.classList.add("message", "bot");
      chatbox.replaceChild(botDiv, typingDiv);

      // Stream response letter by letter smoothly
      const reader = response.body.getReader();
      const decoder = new TextDecoder("utf-8");
      let fullResponse = "";
      const timestamp = getCurrentTime();
      let displayedText = "";
      let isTyping = false;

      // Collect response chunks and queue them for letter-by-letter display
      async function collectAndDisplay() {
        while (true) {
          const { done, value } = await reader.read();
          if (done) break;
          
          const chunk = decoder.decode(value, { stream: true });
          fullResponse += chunk;
          
          // Start displaying if not already typing
          if (!isTyping) {
            isTyping = true;
            typeLetterByLetter();
          }
        }
      }

      function typeLetterByLetter() {
        if (displayedText.length < fullResponse.length) {
          displayedText = fullResponse.substring(0, displayedText.length + 1);
          botDiv.innerHTML = displayedText + `<div class="timestamp">${timestamp}</div>`;
          scrollToBottom();
          setTimeout(typeLetterByLetter, 20); // 20ms per character for smooth typing
        } else {
          // Check if more content is available
          setTimeout(typeLetterByLetter, 50);
        }
      }

      // Start collecting response
      collectAndDisplay();
    });

    // Initialize welcome message when page loads
    window.addEventListener('load', function() {
      setTimeout(showWelcomeMessage, 500); // Small delay for better UX
    });
  </script>
</body>
</html>
